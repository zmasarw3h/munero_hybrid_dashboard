# Executive Overview Page V2 - Enhanced Design & Implementation Plan

## Document Info
- **Version:** 2.0
- **Created:** January 5, 2026
- **Updated:** January 5, 2026
- **Status:** Design Complete - Ready for Implementation

---

## âš ï¸ Data Availability Notes

### Current Database Limitations
The `fact_orders` table **does not have** an `order_status` column. This affects:

1. **Stuck Orders Panel** - Cannot query real stuck/failed/pending orders
2. **Top Products by Status Chart** - Cannot show Completed vs Failed/Stuck breakdown
3. **Operational Health Summary** - Cannot calculate real completion rates

### Implementation Approach: Mock Data for MVP

For features requiring order status data, we will use **realistic mock data** generated by the backend:

| Feature | Data Source | Notes |
|---------|-------------|-------|
| Stuck Orders List | **MOCK** | Generate 3-5 realistic fake stuck orders |
| Top Products by Status | **MOCK** | Apply fake 95% complete / 5% failed distribution |
| Operational Health Donut | **REAL** | Uses `order_type` (Gift Card vs Merchandise) which exists |
| Revenue by Geography | **REAL** | Uses `country` column which exists |
| Top Brands by Type | **REAL** | Uses `order_type` column which exists |
| KPI Sparklines | **REAL** | Aggregates from actual order data |
| Anomaly Ticker | **REAL** | Uses anomaly detection from trend data |

**Mock Data Indicators:**
- Backend returns `is_mock: true` field for mock data endpoints
- Frontend can optionally display "(Demo)" badge on mock-data components
- When real `order_status` data becomes available, simply update the SQL queries

---

## Design Overview

This document describes the enhanced Executive Overview page layout that maximizes information density, addresses the client's wishlist requirements, and provides a "command center" experience.

### Key Changes from V1:
1. **KPI Cards Enhanced** - Added sparklines and contextual info
2. **Zone 3 Layout Shift** - 8/12 + 4/12 split with Operational Health panel
3. **Zone 4 Redesigned** - Geographic Map + Top Performers with toggle
4. **Zone 5 Anomaly Ticker** - Horizontal scrollable strip at bottom
5. **AI Access** - Slide-over panel triggered by header button (no bottom input)

---

## Visual Layout (ASCII)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [Date Range] [Currency] [Country] [Type] [More Filters â–¾]  ğŸ¤– Ask AI  Last: X     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                     â”‚
â”‚  ZONE 2: KPI CARDS (5 cards, enhanced)                                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ Total Orders â”‚ â”‚ Revenue      â”‚ â”‚ AOV          â”‚ â”‚ Ord/Client   â”‚ â”‚ âš ï¸ Stuck    â”‚â”‚
â”‚ â”‚ 22,935       â”‚ â”‚ 4.2M AED     â”‚ â”‚ 185 AED      â”‚ â”‚ 1.78         â”‚ â”‚ 3 orders    â”‚â”‚
â”‚ â”‚ â–â–‚â–ƒâ–…â–†â–‡       â”‚ â”‚ â–â–ƒâ–…â–†â–‡â–ˆ       â”‚ â”‚ â†‘ 8.2%       â”‚ â”‚ Top: Acme    â”‚ â”‚ Max: 4 days â”‚â”‚
â”‚ â”‚ â†‘ 12.5%      â”‚ â”‚ â†‘ 15.3%      â”‚ â”‚ vs prior     â”‚ â”‚              â”‚ â”‚ [View â†’]    â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                     â”‚
â”‚  ZONE 3: MAIN TREND & OPERATIONAL HEALTH                                            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Sales & Volume Trend                     (col-span-8) â”‚ â”‚ Operational (col-4)   â”‚ â”‚
â”‚ â”‚                                                       â”‚ â”‚                       â”‚ â”‚
â”‚ â”‚  [Day] [Month] [Year]              [â‡„ Swap Axis]      â”‚ â”‚ Revenue by Type       â”‚ â”‚
â”‚ â”‚                                                       â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚ â”‚   600K â”¤                                              â”‚ â”‚ â”‚    â— Donut      â”‚   â”‚ â”‚
â”‚ â”‚   450K â”¤  â–“â–“â–“                                         â”‚ â”‚ â”‚                 â”‚   â”‚ â”‚
â”‚ â”‚   300K â”¤  â–“â–“â–“â–“â–“â–“â–“â–“                    â–“â–“â–“             â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚ â”‚   150K â”¤  â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â”€â”€â”€â”€â—‹â”€â”€             â”‚ â”‚ Gift Card  77%  3.2M  â”‚ â”‚
â”‚ â”‚      0 â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€            â”‚ â”‚ Merch      23%  0.9M  â”‚ â”‚
â”‚ â”‚        Jun  Jul  Aug  Sep  Oct  Nov  Dec              â”‚ â”‚                       â”‚ â”‚
â”‚ â”‚                                                       â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚
â”‚ â”‚  â— Anomalies  â–“ Revenue  â”€ Orders                     â”‚ â”‚ âš ï¸ Attention Required â”‚ â”‚
â”‚ â”‚                                                       â”‚ â”‚ #9921 Stuck    4d [â†»] â”‚ â”‚
â”‚ â”‚                                                       â”‚ â”‚ #9918 Failed   2d [â†»] â”‚ â”‚
â”‚ â”‚                                                       â”‚ â”‚ #9915 Pending  1d [â†’] â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                     â”‚
â”‚  ZONE 4: GEOGRAPHIC & TOP PERFORMERS                                                â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Revenue by Geography (col-span-6)   â”‚ â”‚ Top Performers (col-span-6)             â”‚ â”‚
â”‚ â”‚                                     â”‚ â”‚ [â— Products] [â—‹ Brands]                 â”‚ â”‚
â”‚ â”‚   ğŸ—ºï¸ Interactive Map                â”‚ â”‚                                         â”‚ â”‚
â”‚ â”‚   (react-simple-maps)               â”‚ â”‚ When "Products" selected:               â”‚ â”‚
â”‚ â”‚                                     â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚ â”‚   [Middle East / World toggle]      â”‚ â”‚ â”‚ Amazon â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–“â–“          â”‚ â”‚ â”‚
â”‚ â”‚                                     â”‚ â”‚ â”‚ Harrods â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–“            â”‚ â”‚ â”‚
â”‚ â”‚   Color intensity = Revenue         â”‚ â”‚ â”‚ iTunes â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                â”‚ â”‚ â”‚
â”‚ â”‚                                     â”‚ â”‚ â”‚ Google â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–“â–“â–“                â”‚ â”‚ â”‚
â”‚ â”‚   Hover tooltip:                    â”‚ â”‚ â”‚ Netflix â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                    â”‚ â”‚ â”‚
â”‚ â”‚   - Country: UAE                    â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚ â”‚   - Revenue: 3.1M AED               â”‚ â”‚ Legend: â–ˆâ–ˆ Completed  â–“â–“ Failed/Stuck  â”‚ â”‚
â”‚ â”‚   - Orders: 18,234                  â”‚ â”‚                                         â”‚ â”‚
â”‚ â”‚   - Clients: 45                     â”‚ â”‚ When "Brands" selected:                 â”‚ â”‚
â”‚ â”‚                                     â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚ â”‚   Click â†’ Filter to country         â”‚ â”‚ â”‚ Noon    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘       â”‚ â”‚ â”‚
â”‚ â”‚                                     â”‚ â”‚ â”‚ Amazon  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘        â”‚ â”‚ â”‚
â”‚ â”‚                                     â”‚ â”‚ â”‚ Virgin  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘           â”‚ â”‚ â”‚
â”‚ â”‚                                     â”‚ â”‚ â”‚ Apple   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ          â”‚ â”‚ â”‚
â”‚ â”‚                                     â”‚ â”‚ â”‚ Carref. â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘              â”‚ â”‚ â”‚
â”‚ â”‚                                     â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚ â”‚                                     â”‚ â”‚ Legend: â–ˆâ–ˆ Gift Card  â–‘â–‘ Merchandise   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                     â”‚
â”‚  ZONE 5: ANOMALY TICKER (Horizontal Scrollable Strip)                               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ âš ï¸ â”‚ Jun 2: Revenue +139% (Z=3.2) â”‚ May 15: Orders -42% (Z=2.8) â”‚ Apr 28: ... â†’ â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Zone-by-Zone Specification

### Zone 1: Global Filters (Sticky Header) - UNCHANGED
Keep current implementation. Add "ğŸ¤– Ask AI" button that triggers slide-over panel.

---

### Zone 2: KPI Cards (Enhanced)

| Card | Primary Value | Secondary Info | Tertiary | Priority |
|------|---------------|----------------|----------|----------|
| **Total Orders** | 22,935 | Sparkline (area chart) | â†‘12.5% vs prior | MVP |
| **Total Revenue** | 4.2M AED | Sparkline (line chart) | â†‘15.3% vs prior | MVP |
| **Avg Order Value** | 185 AED | â†‘8.2% vs prior | â€” | MVP |
| **Orders per Client** | 1.78 | Top Client: "Acme Corp" | â€” | MVP |
| **âš ï¸ Stuck Orders** | 3 orders | Max Age: 4 days | [View â†’] button | MVP |

**Card Layout (Per Card):**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Label                   ğŸ“Š  â”‚  â† Icon indicating chart/action
â”‚ PRIMARY VALUE               â”‚  â† Large, prominent
â”‚ â–â–‚â–ƒâ–…â–†â–‡ (sparkline)         â”‚  â† Mini visualization
â”‚ â†‘ X% vs prior period        â”‚  â† Comparison badge
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Sparkline Details:**
- **Total Orders**: Area chart, 30-day trend
- **Total Revenue**: Line chart, 30-day trend
- Uses Recharts `<AreaChart>` or `<LineChart>` with minimal config

**"Stuck Orders" Card Special Behavior:**
- Red/amber accent color
- Click "[View â†’]" opens the Operational Health panel's detailed list
- Fetches from new endpoint: `GET /api/dashboard/stuck-orders`

---

### Zone 3: Main Trend & Operational Health

**Layout:** `grid grid-cols-12 gap-4`

#### 3A: Sales & Volume Trend (col-span-8)
- **Component:** Existing `<DualAxisChart />`
- **Data:** From `apiClient.getTrend(filters, granularity)`
- **Features:**
  - Granularity toggle: [Day] [Month] [Year]
  - Swap Axis button (v2)
  - Anomaly dots overlay (red scatter points)
  - Tooltip with date, revenue, orders, % change

#### 3B: Operational Health Panel (col-span-4)

**Sub-Widget 1: Revenue by Type (Compact Donut)**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Revenue by Type           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚       â— Donut         â”‚ â”‚  â† Smaller than current, maybe 120px diameter
â”‚ â”‚                       â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Gift Card   77%  3.2M â”‚ â”‚  â† Legend as table (not just hover)
â”‚ â”‚ Merch       23%  0.9M â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Sub-Widget 2: Critical Alerts / Stuck Orders**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš ï¸ Attention Required     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ #9921  Stuck      4d  [â†»] â”‚  â† Order number, status, age, retry button
â”‚ #9918  Failed     2d  [â†»] â”‚
â”‚ #9915  Pending    1d  [â†’] â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚ [View All (12)]           â”‚  â† Link to full list/modal
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Data Source:** New endpoint `GET /api/dashboard/stuck-orders`

**Row Actions:**
- `[â†»]` Retry button - triggers retry (future integration)
- `[â†’]` View details - opens modal or navigates to order detail

---

### Zone 4: Geographic & Top Performers

**Layout:** `grid grid-cols-2 gap-4`

#### 4A: Revenue by Geography (Interactive Map)

**Library:** `react-simple-maps`

**Features:**
| Feature | Description | Priority |
|---------|-------------|----------|
| Map Display | World map or Middle East zoom | MVP |
| Color Intensity | Choropleth based on revenue | MVP |
| Hover Tooltip | Country, Revenue, Orders, Clients | MVP |
| Click to Filter | Updates FilterContext.countries | MVP |
| Region Toggle | [Middle East] [World] | v2 |

**Tooltip Content:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ‡¦ğŸ‡ª United Arab Emirates â”‚
â”‚ Revenue: 3.1M AED   â”‚
â”‚ Orders: 18,234      â”‚
â”‚ Clients: 45         â”‚
â”‚ [Click to filter]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Color Scale:** 
- Light blue (low revenue) â†’ Dark blue (high revenue)
- Use `d3-scale` for color interpolation

#### 4B: Top Performers (Stacked Bar with Toggle)

**Toggle Options:** `[â— Products] [â—‹ Brands]`

**When "Products" Selected:**
- **Chart Type:** Horizontal Stacked Bar Chart
- **Stacks:** 
  - `Completed` (Green #22c55e)
  - `Failed/Stuck` (Red/Amber #ef4444 / #f59e0b)
- **Data:** Top 10 products by total revenue
- **Purpose:** Shows fulfillment health per product

```
Product Name          Revenue Breakdown
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Amazon Gift    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–“â–“        $400K ($380K OK, $20K stuck)
Harrods Card   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–“           $280K ($265K OK, $15K stuck)
iTunes $50     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ              $180K (all OK)
Google Play    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–“â–“â–“              $150K ($120K OK, $30K stuck) âš ï¸
Netflix        â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                   $100K (all OK)
```

**Insight:** Large red/amber segments = fulfillment problems with top products

**When "Brands" Selected:**
- **Chart Type:** Horizontal Stacked Bar Chart
- **Stacks:**
  - `Gift Card` (Blue #3b82f6)
  - `Merchandise` (Purple #8b5cf6)
- **Data:** Top 10 brands by total revenue
- **Purpose:** Shows product type mix per brand

```
Brand Name           Revenue Breakdown
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Noon          â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘       $500K ($400K GC, $100K Merch)
Amazon        â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘        $480K ($450K GC, $30K Merch)
Virgin        â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘           $350K ($200K GC, $150K Merch)
Apple         â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ          $320K (100% GC)
Carrefour     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘              $280K ($160K GC, $120K Merch)
```

**Insight:** Portfolio composition - is brand mostly digital (GC) or physical (Merch)?

**Tooltip (Both Views):**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Amazon.com Gift Card       â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚ Total Revenue: $400,000    â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚ âœ“ Completed: $380,000 (95%)â”‚
â”‚ âš  Stuck/Failed: $20,000 (5%)â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚ Orders: 2,340              â”‚
â”‚ [Click to filter â†’]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Zone 5: Anomaly Ticker (Horizontal Scrollable Strip)

**Position:** Fixed at bottom of the Overview page (not floating/sticky)

**Component:** `<AnomalyTicker />`

**Visual:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš ï¸ â”‚ Jun 2: Revenue +139% (Z=3.2) â”‚ May 15: Orders -42% (Z=2.8) â”‚ Apr 28: +85% â”‚ â†’  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Behavior:**
- **Static horizontal strip** - user can drag/scroll left-right
- **No auto-animation** - user controls scrolling
- Uses CSS `overflow-x: auto` with custom scrollbar styling
- Optional: CSS `scroll-snap-type: x mandatory` for nice snapping

**Item Format:**
```
[Date]: [Metric] [+/-X%] (Z=[score])
```

**Color Coding:**
- Positive anomalies: Green badge
- Negative anomalies: Red badge

**Click Action:** 
- Click item â†’ Filters dashboard to that date
- (v2) Opens AI chat with pre-filled question: "What caused the anomaly on [date]?"

**Data Source:** 
- Extracted from trend data where `is_revenue_anomaly` or `is_order_anomaly` is true
- Sorted by absolute Z-score (highest first)

---

## New Components Required

### Frontend Components

| Component | File Path | Description |
|-----------|-----------|-------------|
| `EnhancedKPICard` | `components/dashboard/EnhancedKPICard.tsx` | KPI card with sparkline support |
| `MiniSparkline` | `components/dashboard/MiniSparkline.tsx` | Tiny inline chart for KPI cards |
| `OperationalHealthPanel` | `components/dashboard/OperationalHealthPanel.tsx` | Right sidebar with donut + alerts |
| `CompactDonut` | `components/dashboard/CompactDonut.tsx` | Small donut with legend table |
| `StuckOrdersList` | `components/dashboard/StuckOrdersList.tsx` | List of problematic orders |
| `GeographyMap` | `components/dashboard/GeographyMap.tsx` | Interactive choropleth map |
| `TopPerformersChart` | `components/dashboard/TopPerformersChart.tsx` | Stacked bar with Products/Brands toggle |
| `AnomalyTicker` | `components/dashboard/AnomalyTicker.tsx` | Horizontal scrollable anomaly strip |

### Backend Endpoints Required

| Endpoint | Method | Purpose |
|----------|--------|---------|
| `GET /api/dashboard/stuck-orders` | GET | List of stuck/failed orders with aging |
| `GET /api/dashboard/sparkline/{metric}` | GET | 30-day trend data for KPI sparklines |
| `GET /api/dashboard/geography` | GET | Revenue/orders aggregated by country |
| `GET /api/dashboard/top-products-by-status` | GET | Top products with completed vs failed breakdown |
| `GET /api/dashboard/top-brands-by-type` | GET | Top brands with gift_card vs merchandise breakdown |

---

## Data Structures

### Stuck Orders Response
```typescript
interface StuckOrder {
  order_number: string;
  order_date: string;
  status: 'stuck' | 'failed' | 'pending';
  age_days: number;
  product_name: string;
  client_name: string;
  amount: number;
}

interface StuckOrdersResponse {
  total_count: number;
  orders: StuckOrder[];
  is_mock: boolean;  // True when using mock data (no order_status in DB)
}
```

### Geography Response
```typescript
interface CountryData {
  country_code: string;  // ISO 3166-1 alpha-2 (e.g., "AE", "SA")
  country_name: string;
  revenue: number;
  orders: number;
  clients: number;
}

interface GeographyResponse {
  data: CountryData[];
}
```

### Top Products by Status Response
```typescript
interface ProductByStatus {
  product_name: string;
  product_sku: string;
  brand: string;
  total_revenue: number;
  completed_revenue: number;
  failed_revenue: number;
  stuck_revenue: number;
  completed_count: number;
  failed_count: number;
  stuck_count: number;
}

interface TopProductsByStatusResponse {
  data: ProductByStatus[];
  is_mock: boolean;  // True when status breakdown is simulated
}
```

### Top Brands by Type Response
```typescript
interface BrandByType {
  brand_name: string;
  total_revenue: number;
  gift_card_revenue: number;
  merchandise_revenue: number;
  gift_card_orders: number;
  merchandise_orders: number;
}

interface TopBrandsByTypeResponse {
  data: BrandByType[];
}
```

---

## Implementation Plan

### Phase 1: Backend Endpoints (Required First)

#### Task 1.1: Stuck Orders Endpoint âš ï¸ MOCK DATA
**File:** `backend/app/api/dashboard.py`

> **Note:** Since `order_status` column doesn't exist in the database, this endpoint returns 
> realistic mock data for demo/development purposes.

```python
@router.get("/stuck-orders")
async def get_stuck_orders(limit: int = 10):
    """
    Returns MOCK stuck/failed/pending orders for demo purposes.
    TODO: Replace with real query when order_status column is added.
    """
    import random
    from datetime import datetime, timedelta
    
    # Generate realistic mock data
    mock_statuses = ['stuck', 'failed', 'pending']
    mock_products = ['Amazon Gift Card $50', 'iTunes Gift Card $25', 'Google Play $100', 
                     'Netflix Subscription', 'Spotify Premium', 'PlayStation Store $50']
    mock_clients = ['Acme Corp', 'Global Trade LLC', 'Tech Solutions', 'MediaBuy Inc']
    
    orders = []
    for i in range(min(limit, 5)):  # Max 5 mock orders
        age = random.randint(1, 7)
        orders.append({
            "order_number": f"ORD-{99200 + i}",
            "order_date": (datetime.now() - timedelta(days=age)).strftime("%Y-%m-%d"),
            "status": mock_statuses[i % 3],
            "age_days": age,
            "product_name": mock_products[i % len(mock_products)],
            "client_name": mock_clients[i % len(mock_clients)],
            "amount": round(random.uniform(50, 500), 2)
        })
    
    return {
        "total_count": len(orders),
        "orders": orders,
        "is_mock": True  # Flag for frontend to optionally show demo indicator
    }
```

#### Task 1.2: Sparkline Data Endpoint
**File:** `backend/app/api/dashboard.py`

```python
@router.get("/sparkline/{metric}")
async def get_sparkline_data(metric: str, days: int = 30):
    """
    Returns daily aggregated data for sparkline visualization.
    metric: 'orders' | 'revenue'
    """
    agg = "COUNT(DISTINCT order_number)" if metric == "orders" else "SUM(order_price_in_aed)"
    query = f"""
        SELECT 
            order_date as date,
            {agg} as value
        FROM fact_orders
        WHERE order_date >= date('now', '-{days} days')
        GROUP BY order_date
        ORDER BY order_date
    """
```

#### Task 1.3: Geography Endpoint
**File:** `backend/app/api/dashboard.py`

```python
@router.get("/geography")
async def get_geography_data(filters: DashboardFilters = Depends()):
    """
    Returns revenue and order metrics aggregated by country.
    """
    query = """
        SELECT 
            client_country as country_name,
            SUM(order_price_in_aed) as revenue,
            COUNT(DISTINCT order_number) as orders,
            COUNT(DISTINCT client_name) as clients
        FROM fact_orders
        WHERE {filter_clause}
        GROUP BY client_country
        ORDER BY revenue DESC
    """
```

#### Task 1.4: Top Products by Status Endpoint âš ï¸ MOCK STATUS DATA
**File:** `backend/app/api/dashboard.py`

> **Note:** Since `order_status` column doesn't exist, we query real product totals
> but apply a mock 95%/5% split for completed vs failed/stuck.

```python
@router.post("/top-products-by-status")
async def get_top_products_by_status(filters: DashboardFilters, limit: int = 10):
    """
    Returns top products with revenue breakdown by order status.
    Uses MOCK status distribution (95% complete, 5% failed) applied to real totals.
    TODO: Replace with real status breakdown when order_status column is added.
    """
    # First, get real product totals
    query = """
        SELECT 
            product_name,
            product_sku,
            product_brand as brand,
            SUM(order_price_in_aed) as total_revenue,
            COUNT(DISTINCT order_number) as total_count
        FROM fact_orders
        WHERE {filter_clause}
        GROUP BY product_name, product_sku, product_brand
        ORDER BY total_revenue DESC
        LIMIT :limit
    """
    
    # Then apply mock status distribution
    results = []
    for row in db_results:
        total = row['total_revenue']
        results.append({
            **row,
            "completed_revenue": total * 0.95,  # 95% mock completion rate
            "failed_revenue": total * 0.03,     # 3% mock failure rate
            "stuck_revenue": total * 0.02,      # 2% mock stuck rate
            "completed_count": int(row['total_count'] * 0.95),
            "failed_count": int(row['total_count'] * 0.03),
            "stuck_count": int(row['total_count'] * 0.02),
        })
    
    return {"data": results, "is_mock": True}
    """
```

#### Task 1.5: Top Brands by Type Endpoint
**File:** `backend/app/api/dashboard.py`

```python
@router.post("/top-brands-by-type")
async def get_top_brands_by_type(filters: DashboardFilters, limit: int = 10):
    """
    Returns top brands with revenue breakdown by product type (gift_card vs merchandise).
    """
    query = """
        SELECT 
            product_brand as brand_name,
            SUM(order_price_in_aed) as total_revenue,
            SUM(CASE WHEN order_type = 'gift_card' THEN order_price_in_aed ELSE 0 END) as gift_card_revenue,
            SUM(CASE WHEN order_type = 'merchandise' THEN order_price_in_aed ELSE 0 END) as merchandise_revenue,
            COUNT(CASE WHEN order_type = 'gift_card' THEN 1 END) as gift_card_orders,
            COUNT(CASE WHEN order_type = 'merchandise' THEN 1 END) as merchandise_orders
        FROM fact_orders
        WHERE {filter_clause}
        GROUP BY product_brand
        ORDER BY total_revenue DESC
        LIMIT :limit
    """
```

---

### Phase 2: Frontend Components

#### Task 2.1: MiniSparkline Component
**File:** `frontend/components/dashboard/MiniSparkline.tsx`

```tsx
interface MiniSparklineProps {
  data: number[];
  type: 'area' | 'line';
  color?: string;
  width?: number;
  height?: number;
}
```

Simple Recharts `<AreaChart>` or `<LineChart>` with:
- No axes
- No grid
- No tooltip (or minimal)
- Responsive width

#### Task 2.2: EnhancedKPICard Component
**File:** `frontend/components/dashboard/EnhancedKPICard.tsx`

Extends existing `MetricCard` with:
- Optional sparkline slot
- Optional secondary text (e.g., "Top: Acme Corp")
- Optional action button (e.g., "[View â†’]")

#### Task 2.3: OperationalHealthPanel Component
**File:** `frontend/components/dashboard/OperationalHealthPanel.tsx`

Composite component containing:
- `<CompactDonut />` for product type breakdown
- `<StuckOrdersList />` for critical alerts

#### Task 2.4: CompactDonut Component
**File:** `frontend/components/dashboard/CompactDonut.tsx`

Small PieChart with:
- Inner radius for donut effect
- Legend as table below (not integrated in chart)
- Click segment to filter

#### Task 2.5: StuckOrdersList Component
**File:** `frontend/components/dashboard/StuckOrdersList.tsx`

List component showing:
- Order number
- Status badge (color-coded)
- Age in days
- Action buttons

#### Task 2.6: GeographyMap Component
**File:** `frontend/components/dashboard/GeographyMap.tsx`

Using `react-simple-maps`:
- ComposableMap with Geography components
- Color scale based on revenue
- Tooltip on hover
- Click to filter

**Dependencies to install:**
```bash
npm install react-simple-maps d3-scale
npm install -D @types/d3-scale
```

#### Task 2.7: TopPerformersChart Component
**File:** `frontend/components/dashboard/TopPerformersChart.tsx`

Stacked horizontal bar chart with:
- Toggle state: 'products' | 'brands'
- Different color schemes per mode
- Recharts `<BarChart layout="vertical">` with `<Bar stackId="a">`

#### Task 2.8: AnomalyTicker Component
**File:** `frontend/components/dashboard/AnomalyTicker.tsx`

Horizontal scrollable container:
- `overflow-x: auto`
- `scrollbar-width: thin` (or custom styled)
- `scroll-snap-type: x mandatory` (optional)
- Flex row of anomaly items

```tsx
<div className="flex overflow-x-auto gap-2 pb-2 scrollbar-thin">
  {anomalies.map(a => (
    <AnomalyItem key={a.date} {...a} onClick={() => handleClick(a)} />
  ))}
</div>
```

---

### Phase 3: Page Integration

#### Task 3.1: Update Overview Page Layout
**File:** `frontend/app/dashboard/overview/page.tsx`

Restructure to use new grid layout:
- Zone 2: Enhanced KPI cards
- Zone 3: 8/12 trend + 4/12 operational panel
- Zone 4: 6/6 map + top performers
- Zone 5: Anomaly ticker at bottom

#### Task 3.2: API Client Updates
**File:** `frontend/lib/api-client.ts`

Add new methods:
- `getStuckOrders()`
- `getSparklineData(metric, days)`
- `getGeographyData(filters)`
- `getTopProductsByStatus(filters, limit)`
- `getTopBrandsByType(filters, limit)`

#### Task 3.3: Type Definitions
**File:** `frontend/lib/types.ts`

Add interfaces for all new response types.

---

### Phase 4: Polish & Testing

1. **Responsive Design**
   - 12-col grid â†’ 6/6 â†’ full-width on mobile
   - Anomaly ticker works on touch devices

2. **Loading States**
   - Skeleton loaders for each new component
   - Graceful error handling

3. **Empty States**
   - "No stuck orders" message
   - "No geographic data" for map
   - "No anomalies detected" for ticker

4. **Accessibility**
   - Keyboard navigation for ticker
   - ARIA labels for interactive elements

---

## Dependencies

### NPM Packages to Install

```bash
# For Geography Map
npm install react-simple-maps
npm install d3-scale d3-geo
npm install -D @types/d3-scale @types/d3-geo @types/topojson-client

# TopJSON data for map
# Download world-110m.json from natural earth or use CDN
```

### Data Files

**Map TopoJSON:**
- Option 1: Bundle `world-110m.json` in `/public/data/`
- Option 2: Fetch from CDN at runtime

---

## File Structure After Implementation

```
frontend/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ dashboard/
â”‚   â”‚   â”œâ”€â”€ EnhancedKPICard.tsx       # NEW
â”‚   â”‚   â”œâ”€â”€ MiniSparkline.tsx         # NEW
â”‚   â”‚   â”œâ”€â”€ OperationalHealthPanel.tsx # NEW
â”‚   â”‚   â”œâ”€â”€ CompactDonut.tsx          # NEW
â”‚   â”‚   â”œâ”€â”€ StuckOrdersList.tsx       # NEW
â”‚   â”‚   â”œâ”€â”€ GeographyMap.tsx          # NEW
â”‚   â”‚   â”œâ”€â”€ TopPerformersChart.tsx    # NEW
â”‚   â”‚   â”œâ”€â”€ AnomalyTicker.tsx         # NEW
â”‚   â”‚   â””â”€â”€ ... (existing)
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ types.ts                      # UPDATED with new types
â”‚   â””â”€â”€ api-client.ts                 # UPDATED with new methods
â”œâ”€â”€ app/dashboard/
â”‚   â””â”€â”€ overview/
â”‚       â””â”€â”€ page.tsx                  # REFACTORED

backend/
â”œâ”€â”€ app/api/
â”‚   â””â”€â”€ dashboard.py                  # UPDATED with new endpoints
```

---

## Estimated Effort

| Phase | Tasks | Estimate |
|-------|-------|----------|
| Phase 1: Backend | 5 endpoints | 2-3 hours |
| Phase 2: Components | 8 components | 6-8 hours |
| Phase 3: Integration | Page refactor | 2-3 hours |
| Phase 4: Polish | Testing, responsive | 2-3 hours |
| **Total** | | **12-17 hours** |

---

## Success Criteria

1. âœ… KPI cards show sparklines and contextual info
2. âœ… Operational panel shows product type split + stuck orders
3. âœ… Interactive map with country hover/click
4. âœ… Top Performers toggle between Products (by status) and Brands (by type)
5. âœ… Anomaly ticker is horizontally scrollable
6. âœ… AI chat opens via slide-over panel (not bottom input)
7. âœ… All data updates when filters change
8. âœ… Responsive on tablet/mobile

---

## Next Steps

1. Review and approve this design document
2. Begin Phase 1: Backend endpoints
3. Install required npm packages
4. Implement components in order
5. Integrate into Overview page
6. Test and polish

---

## Future Improvements (Post-MVP)

The following items should be addressed in future iterations:

### 1. Anomaly Ticker Data Source
- Current trend API may not return Z-scores for anomalies
- **Action:** Either add `z_score` field to trend response OR create dedicated `GET /api/dashboard/anomalies` endpoint
- **Priority:** Medium

### 2. Geography Map Country Code Mapping
- Database stores full country names (e.g., "United Arab Emirates")
- `react-simple-maps` requires ISO 3166-1 alpha-2 codes (e.g., "AE")
- **Action:** Create a country name â†’ ISO code mapping utility function
- **Priority:** High (required for map to work)

### 3. KPI Sparkline Filter Behavior
- Current design: Sparkline always shows 30 days
- **Question:** Should sparkline respect user's date filter or always show 30 days for context?
- **Action:** Decide and document expected behavior; possibly add a toggle
- **Priority:** Low

### 4. Stuck Orders Retry Endpoint
- UI shows `[â†»]` retry button but no backend endpoint exists
- **Action:** Create `POST /api/dashboard/orders/{order_id}/retry` endpoint
- **Priority:** Low (v2 feature - button can be disabled for MVP)

### 5. Map Country Mismatch Logging
- If database country name doesn't match TopoJSON geography, it fails silently
- **Action:** Add console warning for unmatched countries; consider fallback display
- **Priority:** Low

---

*Document created: January 5, 2026*
*Ready for implementation upon approval*
